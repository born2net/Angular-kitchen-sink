var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require('angular2/core');
var redux_1 = require("redux");
var thunkMiddleware = require('redux-thunk');
var angular2_redux_util_1 = require("angular2-redux-util");
var Lib = (function () {
    function Lib() {
    }
    Lib.StoreFactory = function (reducerList) {
        return function () {
            var reducers = redux_1.combineReducers(reducerList);
            var middlewareEnhancer = redux_1.applyMiddleware(thunkMiddleware);
            var isDebug = window.devToolsExtension;
            var applyDevTools = function () { return isDebug ? window.devToolsExtension() : function (f) { return f; }; };
            var enhancers = redux_1.compose(middlewareEnhancer, applyDevTools());
            var createStoreWithEnhancers = enhancers(redux_1.createStore);
            var reduxAppStore = createStoreWithEnhancers(reducers);
            return new angular2_redux_util_1.AppStore(reduxAppStore);
        };
    };
    Lib.LoadComponentAsync = function (name, path) {
        return System.import(path).then(function (c) { return c[name]; });
    };
    Lib.log = function (msg) {
        console.log(new Date().toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/, "$1") + ': ' + msg);
    };
    Lib.guid = function () {
        function s4() {
            return Math.floor((1 + Math.random()) * 0x10000)
                .toString(16)
                .substring(1);
        }
        return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
            s4() + '-' + s4() + s4() + s4();
    };
    Lib.Xml2Json = function () {
        var xmlToJSON = (function () {
            this.version = "1.3";
            var options = {
                mergeCDATA: true,
                grokAttr: true,
                grokText: true,
                normalize: true,
                xmlns: true,
                namespaceKey: '_ns',
                textKey: '_text',
                valueKey: '_value',
                attrKey: '_attr',
                cdataKey: '_cdata',
                attrsAsObject: true,
                stripAttrPrefix: true,
                stripElemPrefix: true,
                childrenAsArray: true
            };
            var prefixMatch = new RegExp('(?!xmlns)^.*:/');
            var trimMatch = new RegExp('^\s+|\s+$g');
            this.grokType = function (sValue) {
                if (/^\s*$/.test(sValue)) {
                    return null;
                }
                if (/^(?:true|false)$/i.test(sValue)) {
                    return sValue.toLowerCase() === "true";
                }
                if (isFinite(sValue)) {
                    return parseFloat(sValue);
                }
                return sValue;
            };
            this.parseString = function (xmlString, opt) {
                return this.parseXML(this.stringToXML(xmlString), opt);
            };
            this.parseXML = function (oXMLParent, opt) {
                for (var key in opt) {
                    options[key] = opt[key];
                }
                var vResult = {}, nLength = 0, sCollectedTxt = "";
                if (options.xmlns && oXMLParent.namespaceURI) {
                    vResult[options.namespaceKey] = oXMLParent.namespaceURI;
                }
                if (oXMLParent.attributes && oXMLParent.attributes.length > 0) {
                    var vAttribs = {};
                    for (nLength; nLength < oXMLParent.attributes.length; nLength++) {
                        var oAttrib = oXMLParent.attributes.item(nLength);
                        vContent = {};
                        var attribName = '';
                        if (options.stripAttrPrefix) {
                            attribName = oAttrib.name.replace(prefixMatch, '');
                        }
                        else {
                            attribName = oAttrib.name;
                        }
                        if (options.grokAttr) {
                            vContent[options.valueKey] = this.grokType(oAttrib.value.replace(trimMatch, ''));
                        }
                        else {
                            vContent[options.valueKey] = oAttrib.value.replace(trimMatch, '');
                        }
                        if (options.xmlns && oAttrib.namespaceURI) {
                            vContent[options.namespaceKey] = oAttrib.namespaceURI;
                        }
                        if (options.attrsAsObject) {
                            vAttribs[attribName] = vContent;
                        }
                        else {
                            vResult[options.attrKey + attribName] = vContent;
                        }
                    }
                    if (options.attrsAsObject) {
                        vResult[options.attrKey] = vAttribs;
                    }
                    else {
                    }
                }
                if (oXMLParent.hasChildNodes()) {
                    for (var oNode, sProp, vContent, nItem = 0; nItem < oXMLParent.childNodes.length; nItem++) {
                        oNode = oXMLParent.childNodes.item(nItem);
                        if (oNode.nodeType === 4) {
                            if (options.mergeCDATA) {
                                sCollectedTxt += oNode.nodeValue;
                            }
                            else {
                                if (vResult.hasOwnProperty(options.cdataKey)) {
                                    if (vResult[options.cdataKey].constructor !== Array) {
                                        vResult[options.cdataKey] = [vResult[options.cdataKey]];
                                    }
                                    vResult[options.cdataKey].push(oNode.nodeValue);
                                }
                                else {
                                    if (options.childrenAsArray) {
                                        vResult[options.cdataKey] = [];
                                        vResult[options.cdataKey].push(oNode.nodeValue);
                                    }
                                    else {
                                        vResult[options.cdataKey] = oNode.nodeValue;
                                    }
                                }
                            }
                        }
                        else if (oNode.nodeType === 3) {
                            sCollectedTxt += oNode.nodeValue;
                        }
                        else if (oNode.nodeType === 1) {
                            if (nLength === 0) {
                                vResult = {};
                            }
                            if (options.stripElemPrefix) {
                                sProp = oNode.nodeName.replace(prefixMatch, '');
                            }
                            else {
                                sProp = oNode.nodeName;
                            }
                            vContent = xmlToJSON.parseXML(oNode);
                            if (vResult.hasOwnProperty(sProp)) {
                                if (vResult[sProp].constructor !== Array) {
                                    vResult[sProp] = [vResult[sProp]];
                                }
                                vResult[sProp].push(vContent);
                            }
                            else {
                                if (options.childrenAsArray) {
                                    vResult[sProp] = [];
                                    vResult[sProp].push(vContent);
                                }
                                else {
                                    vResult[sProp] = vContent;
                                }
                                nLength++;
                            }
                        }
                    }
                }
                else if (!sCollectedTxt) {
                    if (options.childrenAsArray) {
                        vResult[options.textKey] = [];
                        vResult[options.textKey].push(null);
                    }
                    else {
                        vResult[options.textKey] = null;
                    }
                }
                if (sCollectedTxt) {
                    if (options.grokText) {
                        var value = this.grokType(sCollectedTxt.replace(trimMatch, ''));
                        if (value !== null && value !== undefined) {
                            vResult[options.textKey] = value;
                        }
                    }
                    else if (options.normalize) {
                        vResult[options.textKey] = sCollectedTxt.replace(trimMatch, '').replace(/\s+/g, " ");
                    }
                    else {
                        vResult[options.textKey] = sCollectedTxt.replace(trimMatch, '');
                    }
                }
                return vResult;
            };
            this.xmlToString = function (xmlDoc) {
                try {
                    var xmlString = xmlDoc.xml ? xmlDoc.xml : (new XMLSerializer()).serializeToString(xmlDoc);
                    return xmlString;
                }
                catch (err) {
                    return null;
                }
            };
            this.stringToXML = function (xmlString) {
                try {
                    var xmlDoc = null;
                    if (window.DOMParser) {
                        var parser = new DOMParser();
                        xmlDoc = parser.parseFromString(xmlString, "text/xml");
                        return xmlDoc;
                    }
                    else {
                        xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
                        xmlDoc.async = false;
                        xmlDoc.loadXML(xmlString);
                        return xmlDoc;
                    }
                }
                catch (e) {
                    return null;
                }
            };
            return this;
        }).call({});
        return xmlToJSON;
    };
    Lib.ReduxLoggerMiddleware = function (store) { return function (next) { return function (action) {
        var result = next(action);
        return result;
    }; }; };
    Lib = __decorate([
        core_1.Injectable(), 
        __metadata('design:paramtypes', [])
    ], Lib);
    return Lib;
})();
exports.Lib = Lib;
if (!Object.assign) {
    Object.defineProperty(Object, "assign", {
        enumerable: false,
        configurable: true,
        writable: true,
        value: function (target) {
            "use strict";
            if (target === undefined || target === null) {
                throw new TypeError("Cannot convert first argument to object");
            }
            var to = Object(target);
            for (var i = 1; i < arguments.length; i++) {
                var nextSource = arguments[i];
                if (nextSource === undefined || nextSource === null) {
                    continue;
                }
                nextSource = Object(nextSource);
                var keysArray = Object.keys(nextSource);
                for (var nextIndex = 0, len = keysArray.length; nextIndex < len; nextIndex++) {
                    var nextKey = keysArray[nextIndex];
                    var desc = Object.getOwnPropertyDescriptor(nextSource, nextKey);
                    if (desc !== undefined && desc.enumerable) {
                        to[nextKey] = nextSource[nextKey];
                    }
                }
            }
            return to;
        }
    });
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi50cyJdLCJuYW1lcyI6WyJMaWIiLCJMaWIuY29uc3RydWN0b3IiLCJMaWIuU3RvcmVGYWN0b3J5IiwiTGliLkxvYWRDb21wb25lbnRBc3luYyIsIkxpYi5sb2ciLCJMaWIuZ3VpZCIsIkxpYi5ndWlkLnM0IiwiTGliLlhtbDJKc29uIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFFQSxxQkFBeUIsZUFBZSxDQUFDLENBQUE7QUFDekMsc0JBQXFFLE9BQU8sQ0FBQyxDQUFBO0FBQzdFLElBQVksZUFBZSxXQUFNLGFBQWEsQ0FBQyxDQUFBO0FBQy9DLG9DQUF1QixxQkFBcUIsQ0FBQyxDQUFBO0FBSTdDO0lBQUFBO0lBd1JBQyxDQUFDQTtJQXJSVUQsZ0JBQVlBLEdBQW5CQSxVQUFvQkEsV0FBa0JBO1FBQ2xDRSxNQUFNQSxDQUFDQTtZQUNIQSxJQUFNQSxRQUFRQSxHQUFHQSx1QkFBZUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsQ0FBQ0E7WUFFOUNBLElBQU1BLGtCQUFrQkEsR0FBR0EsdUJBQWVBLENBQU1BLGVBQWVBLENBQUNBLENBQUNBO1lBQ2pFQSxJQUFNQSxPQUFPQSxHQUFHQSxNQUFNQSxDQUFDQSxpQkFBaUJBLENBQUNBO1lBQ3pDQSxJQUFNQSxhQUFhQSxHQUFHQSxjQUFNQSxPQUFBQSxPQUFPQSxHQUFHQSxNQUFNQSxDQUFDQSxpQkFBaUJBLEVBQUVBLEdBQUdBLFVBQUFBLENBQUNBLElBQUlBLE9BQUFBLENBQUNBLEVBQURBLENBQUNBLEVBQTdDQSxDQUE2Q0EsQ0FBQ0E7WUFDMUVBLElBQU1BLFNBQVNBLEdBQUdBLGVBQU9BLENBQUNBLGtCQUFrQkEsRUFBRUEsYUFBYUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7WUFDL0RBLElBQU1BLHdCQUF3QkEsR0FBR0EsU0FBU0EsQ0FBQ0EsbUJBQVdBLENBQUNBLENBQUNBO1lBQ3hEQSxJQUFNQSxhQUFhQSxHQUFHQSx3QkFBd0JBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBO1lBQ3pEQSxNQUFNQSxDQUFDQSxJ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QUNELFVBQVUsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBRWhDLElBQUksU0FBUyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQ3hDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxTQUFTLENBQUMsTUFBTSxFQUFFLFNBQVMsR0FBRyxHQUFHLEVBQUUsU0FBUyxFQUFFLEVBQUUsQ0FBQztvQkFDM0UsSUFBSSxPQUFPLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDO29CQUNuQyxJQUFJLElBQUksR0FBRyxNQUFNLENBQUMsd0JBQXdCLENBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxDQUFDO29CQUNoRSxFQUFFLENBQUMsQ0FBQyxJQUFJLEtBQUssU0FBUyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO3dCQUN4QyxFQUFFLENBQUMsT0FBTyxDQUFDLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO29CQUN0QyxDQUFDO2dCQUNMLENBQUM7WUFDTCxDQUFDO1lBQ0QsTUFBTSxDQUFDLEVBQUUsQ0FBQztRQUNkLENBQUM7S0FDSixDQUFDLENBQUM7QUFDUCxDQUFDIiwiZmlsZSI6IkxpYi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKiBDb21tb24gTGlicmFyeSAqKi9cclxuXHJcbmltcG9ydCB7SW5qZWN0YWJsZX0gZnJvbSAnYW5ndWxhcjIvY29yZSc7XHJcbmltcG9ydCB7Y3JlYXRlU3RvcmUsIGNvbWJpbmVSZWR1Y2VycywgYXBwbHlNaWRkbGV3YXJlLCBjb21wb3NlfSBmcm9tIFwicmVkdXhcIjtcclxuaW1wb3J0ICogYXMgdGh1bmtNaWRkbGV3YXJlIGZyb20gJ3JlZHV4LXRodW5rJztcclxuaW1wb3J0IHtBcHBTdG9yZX0gZnJvbSBcImFuZ3VsYXIyLXJlZHV4LXV0aWxcIjtcclxuXHJcbmltcG9ydCB7TG9nZ2VyTWlkZGxld2FyZX0gZnJvbSBcImFuZ3VsYXIyLXJlZHV4LXV0aWxcIjtcclxuXHJcbkBJbmplY3RhYmxlKClcclxuZXhwb3J0IGNsYXNzIExpYiB7XHJcblxyXG4gICAgc3RhdGljIFN0b3JlRmFjdG9yeShyZWR1Y2VyTGlzdDpPYmplY3QpIHtcclxuICAgICAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZWR1Y2VycyA9IGNvbWJpbmVSZWR1Y2VycyhyZWR1Y2VyTGlzdCk7XHJcbiAgICAgICAgICAgIC8vY29uc3QgbWlkZGxld2FyZUVuaGFuY2VyID0gYXBwbHlNaWRkbGV3YXJlKDxhbnk+dGh1bmtNaWRkbGV3YXJlLCBMb2dnZXJNaWRkbGV3YXJlKTsgLy8gdG8gZW5hYmxlIGxvZ2dlclxyXG4gICAgICAgICAgICBjb25zdCBtaWRkbGV3YXJlRW5oYW5jZXIgPSBhcHBseU1pZGRsZXdhcmUoPGFueT50aHVua01pZGRsZXdhcmUpO1xyXG4gICAgICAgICAgICBjb25zdCBpc0RlYnVnID0gd2luZG93LmRldlRvb2xzRXh0ZW5zaW9uO1xyXG4gICAgICAgICAgICBjb25zdCBhcHBseURldlRvb2xzID0gKCkgPT4gaXNEZWJ1ZyA/IHdpbmRvdy5kZXZUb29sc0V4dGVuc2lvbigpIDogZiA9PiBmO1xyXG4gICAgICAgICAgICBjb25zdCBlbmhhbmNlcnMgPSBjb21wb3NlKG1pZGRsZXdhcmVFbmhhbmNlciwgYXBwbHlEZXZUb29scygpKTtcclxuICAgICAgICAgICAgY29uc3QgY3JlYXRlU3RvcmVXaXRoRW5oYW5jZXJzID0gZW5oYW5jZXJzKGNyZWF0ZVN0b3JlKTtcclxuICAgICAgICAgICAgY29uc3QgcmVkdXhBcHBTdG9yZSA9IGNyZWF0ZVN0b3JlV2l0aEVuaGFuY2VycyhyZWR1Y2Vycyk7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgQXBwU3RvcmUocmVkdXhBcHBTdG9yZSk7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgTG9hZENvbXBvbmVudEFzeW5jKG5hbWU6c3RyaW5nLCBwYXRoOnN0cmluZykge1xyXG5cclxuICAgICAgICByZXR1cm4gU3lzdGVtLmltcG9ydChwYXRoKS50aGVuKGMgPT4gY1tuYW1lXSk7XHJcblxyXG4gICAgICAgIC8vcmV0dXJuIFN5c3RlbS5pbXBvcnQoJy9kaXN0L3B1YmxpYy9vdXQuanMnKVxyXG4gICAgICAgIC8vICAgIC5jYXRjaChmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIC8vICAgICAgICBhbGVydCgncHJvYiBsb2FkaW5nIG91dC5qcyAnICsgZSk7XHJcbiAgICAgICAgLy8gICAgfSkudGhlbihmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIC8vICAgICAgICBhbGVydChlKTtcclxuICAgICAgICAvLyAgICAgICAgYWxlcnQoZVtuYW1lXSk7XHJcbiAgICAgICAgLy8gICAgICAgIGFsZXJ0KEpTT04uc3RyaW5naWZ5KGUpKTtcclxuICAgICAgICAvLyAgICAgICAgcmV0dXJuIFN5c3RlbS5pbXBvcnQoJ0FwcDEnKS50aGVuKGMgPT4gY1tuYW1lXSk7XHJcbiAgICAgICAgLy8gICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGxvZyhtc2cpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhuZXcgRGF0ZSgpLnRvVGltZVN0cmluZygpLnJlcGxhY2UoLy4qKFxcZHsyfTpcXGR7Mn06XFxkezJ9KS4qLywgXCIkMVwiKSArICc6ICcgKyBtc2cpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBndWlkKCk6c3RyaW5nIHtcclxuICAgICAgICBmdW5jdGlvbiBzNCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoKDEgKyBNYXRoLnJhbmRvbSgpKSAqIDB4MTAwMDApXHJcbiAgICAgICAgICAgICAgICAudG9TdHJpbmcoMTYpXHJcbiAgICAgICAgICAgICAgICAuc3Vic3RyaW5nKDEpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHM0KCkgKyBzNCgpICsgJy0nICsgczQoKSArICctJyArIHM0KCkgKyAnLScgK1xyXG4gICAgICAgICAgICBzNCgpICsgJy0nICsgczQoKSArIHM0KCkgKyBzNCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBSZWR1eExvZ2dlck1pZGRsZXdhcmUgPSBzdG9yZSA9PiBuZXh0ID0+IGFjdGlvbiA9PiB7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJkaXNwYXRjaGluZ1wiLCBhY3Rpb24udHlwZSk7XHJcbiAgICAgICAgbGV0IHJlc3VsdCA9IG5leHQoYWN0aW9uKTtcclxuICAgICAgICAvL2NvbnNvbGUubG9nKFwibmV4dCBzdGF0ZVwiLCBzdG9yZS5nZXRTdGF0ZSgpKTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0XHJcbiAgICB9O1xyXG5cclxuICAgIHN0YXRpYyBYbWwySnNvbigpIHtcclxuICAgICAgICAvL2h0dHBzOi8vZ2l0aHViLmNvbS9tZXRhdHJpYmFsL3htbFRvSlNPTlxyXG4gICAgICAgIHZhciB4bWxUb0pTT04gPSAoZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gXCIxLjNcIjtcclxuXHJcbiAgICAgICAgICAgIHZhciBvcHRpb25zID0geyAvLyBzZXQgdXAgdGhlIGRlZmF1bHQgb3B0aW9uc1xyXG4gICAgICAgICAgICAgICAgbWVyZ2VDREFUQTogdHJ1ZSwgLy8gZXh0cmFjdCBjZGF0YSBhbmQgbWVyZ2Ugd2l0aCB0ZXh0XHJcbiAgICAgICAgICAgICAgICBncm9rQXR0cjogdHJ1ZSwgLy8gY29udmVydCB0cnV0aHkgYXR0cmlidXRlcyB0byBib29sZWFuLCBldGNcclxuICAgICAgICAgICAgICAgIGdyb2tUZXh0OiB0cnVlLCAvLyBjb252ZXJ0IHRydXRoeSB0ZXh0L2F0dHIgdG8gYm9vbGVhbiwgZXRjXHJcbiAgICAgICAgICAgICAgICBub3JtYWxpemU6IHRydWUsIC8vIGNvbGxhcHNlIG11bHRpcGxlIHNwYWNlcyB0byBzaW5nbGUgc3BhY2VcclxuICAgICAgICAgICAgICAgIHhtbG5zOiB0cnVlLCAvLyBpbmNsdWRlIG5hbWVzcGFjZXMgYXMgYXR0cmlidXRlIGluIG91dHB1dFxyXG4gICAgICAgICAgICAgICAgbmFtZXNwYWNlS2V5OiAnX25zJywgLy8gdGFnIG5hbWUgZm9yIG5hbWVzcGFjZSBvYmplY3RzXHJcbiAgICAgICAgICAgICAgICB0ZXh0S2V5OiAnX3RleHQnLCAvLyB0YWcgbmFtZSBmb3IgdGV4dCBub2Rlc1xyXG4gICAgICAgICAgICAgICAgdmFsdWVLZXk6ICdfdmFsdWUnLCAvLyB0YWcgbmFtZSBmb3IgYXR0cmlidXRlIHZhbHVlc1xyXG4gICAgICAgICAgICAgICAgYXR0cktleTogJ19hdHRyJywgLy8gdGFnIGZvciBhdHRyIGdyb3Vwc1xyXG4gICAgICAgICAgICAgICAgY2RhdGFLZXk6ICdfY2RhdGEnLCAvLyB0YWcgZm9yIGNkYXRhIG5vZGVzIChpZ25vcmVkIGlmIG1lcmdlQ0RBVEEgaXMgdHJ1ZSlcclxuICAgICAgICAgICAgICAgIGF0dHJzQXNPYmplY3Q6IHRydWUsIC8vIGlmIGZhbHNlLCBrZXkgaXMgdXNlZCBhcyBwcmVmaXggdG8gbmFtZSwgc2V0IHByZWZpeCB0byAnJyB0byBtZXJnZSBjaGlsZHJlbiBhbmQgYXR0cnMuXHJcbiAgICAgICAgICAgICAgICBzdHJpcEF0dHJQcmVmaXg6IHRydWUsIC8vIHJlbW92ZSBuYW1lc3BhY2UgcHJlZml4ZXMgZnJvbSBhdHRyaWJ1dGVzXHJcbiAgICAgICAgICAgICAgICBzdHJpcEVsZW1QcmVmaXg6IHRydWUsIC8vIGZvciBlbGVtZW50cyBvZiBzYW1lIG5hbWUgaW4gZGlmZiBuYW1lc3BhY2VzLCB5b3UgY2FuIGVuYWJsZSBuYW1lc3BhY2VzIGFuZCBhY2Nlc3MgdGhlIG5za2V5IHByb3BlcnR5XHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbkFzQXJyYXk6IHRydWUgLy8gZm9yY2UgY2hpbGRyZW4gaW50byBhcnJheXNcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZhciBwcmVmaXhNYXRjaDphbnkgPSBuZXcgUmVnRXhwKCcoPyF4bWxucyleLio6LycpO1xyXG4gICAgICAgICAgICB2YXIgdHJpbU1hdGNoOmFueSA9IG5ldyBSZWdFeHAoJ15cXHMrfFxccyskZycpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5ncm9rVHlwZSA9IGZ1bmN0aW9uIChzVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIGlmICgvXlxccyokLy50ZXN0KHNWYWx1ZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmICgvXig/OnRydWV8ZmFsc2UpJC9pLnRlc3Qoc1ZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzVmFsdWUudG9Mb3dlckNhc2UoKSA9PT0gXCJ0cnVlXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNGaW5pdGUoc1ZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KHNWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc1ZhbHVlO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdGhpcy5wYXJzZVN0cmluZyA9IGZ1bmN0aW9uICh4bWxTdHJpbmcsIG9wdCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VYTUwodGhpcy5zdHJpbmdUb1hNTCh4bWxTdHJpbmcpLCBvcHQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLnBhcnNlWE1MID0gZnVuY3Rpb24gKG9YTUxQYXJlbnQsIG9wdCkge1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIGluaXRpYWxpemUgb3B0aW9uc1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIG9wdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnNba2V5XSA9IG9wdFtrZXldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciB2UmVzdWx0ID0ge30sXHJcbiAgICAgICAgICAgICAgICAgICAgbkxlbmd0aCA9IDAsXHJcbiAgICAgICAgICAgICAgICAgICAgc0NvbGxlY3RlZFR4dCA9IFwiXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gcGFyc2UgbmFtZXNwYWNlIGluZm9ybWF0aW9uXHJcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy54bWxucyAmJiBvWE1MUGFyZW50Lm5hbWVzcGFjZVVSSSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZSZXN1bHRbb3B0aW9ucy5uYW1lc3BhY2VLZXldID0gb1hNTFBhcmVudC5uYW1lc3BhY2VVUkk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gcGFyc2UgYXR0cmlidXRlc1xyXG4gICAgICAgICAgICAgICAgLy8gdXNpbmcgYXR0cmlidXRlcyBwcm9wZXJ0eSBpbnN0ZWFkIG9mIGhhc0F0dHJpYnV0ZXMgbWV0aG9kIHRvIHN1cHBvcnQgb2xkZXIgYnJvd3NlcnNcclxuICAgICAgICAgICAgICAgIGlmIChvWE1MUGFyZW50LmF0dHJpYnV0ZXMgJiYgb1hNTFBhcmVudC5hdHRyaWJ1dGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdkF0dHJpYnMgPSB7fTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChuTGVuZ3RoOyBuTGVuZ3RoIDwgb1hNTFBhcmVudC5hdHRyaWJ1dGVzLmxlbmd0aDsgbkxlbmd0aCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvQXR0cmliID0gb1hNTFBhcmVudC5hdHRyaWJ1dGVzLml0ZW0obkxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZDb250ZW50ID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhdHRyaWJOYW1lID0gJyc7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5zdHJpcEF0dHJQcmVmaXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYk5hbWUgPSBvQXR0cmliLm5hbWUucmVwbGFjZShwcmVmaXhNYXRjaCwgJycpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYk5hbWUgPSBvQXR0cmliLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmdyb2tBdHRyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2Q29udGVudFtvcHRpb25zLnZhbHVlS2V5XSA9IHRoaXMuZ3Jva1R5cGUob0F0dHJpYi52YWx1ZS5yZXBsYWNlKHRyaW1NYXRjaCwgJycpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZDb250ZW50W29wdGlvbnMudmFsdWVLZXldID0gb0F0dHJpYi52YWx1ZS5yZXBsYWNlKHRyaW1NYXRjaCwgJycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy54bWxucyAmJiBvQXR0cmliLm5hbWVzcGFjZVVSSSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdkNvbnRlbnRbb3B0aW9ucy5uYW1lc3BhY2VLZXldID0gb0F0dHJpYi5uYW1lc3BhY2VVUkk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmF0dHJzQXNPYmplY3QpIHsgLy8gYXR0cmlidXRlcyB3aXRoIHNhbWUgbG9jYWwgbmFtZSBtdXN0IGVuYWJsZSBwcmVmaXhlc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdkF0dHJpYnNbYXR0cmliTmFtZV0gPSB2Q29udGVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZSZXN1bHRbb3B0aW9ucy5hdHRyS2V5ICsgYXR0cmliTmFtZV0gPSB2Q29udGVudDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuYXR0cnNBc09iamVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2UmVzdWx0W29wdGlvbnMuYXR0cktleV0gPSB2QXR0cmlicztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAvLyBpdGVyYXRlIG92ZXIgdGhlIGNoaWxkcmVuXHJcbiAgICAgICAgICAgICAgICBpZiAob1hNTFBhcmVudC5oYXNDaGlsZE5vZGVzKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBvTm9kZSwgc1Byb3AsIHZDb250ZW50LCBuSXRlbSA9IDA7IG5JdGVtIDwgb1hNTFBhcmVudC5jaGlsZE5vZGVzLmxlbmd0aDsgbkl0ZW0rKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvTm9kZSA9IG9YTUxQYXJlbnQuY2hpbGROb2Rlcy5pdGVtKG5JdGVtKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvTm9kZS5ub2RlVHlwZSA9PT0gNCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMubWVyZ2VDREFUQSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNDb2xsZWN0ZWRUeHQgKz0gb05vZGUubm9kZVZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodlJlc3VsdC5oYXNPd25Qcm9wZXJ0eShvcHRpb25zLmNkYXRhS2V5KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodlJlc3VsdFtvcHRpb25zLmNkYXRhS2V5XS5jb25zdHJ1Y3RvciAhPT0gQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZSZXN1bHRbb3B0aW9ucy5jZGF0YUtleV0gPSBbdlJlc3VsdFtvcHRpb25zLmNkYXRhS2V5XV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdlJlc3VsdFtvcHRpb25zLmNkYXRhS2V5XS5wdXNoKG9Ob2RlLm5vZGVWYWx1ZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmNoaWxkcmVuQXNBcnJheSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdlJlc3VsdFtvcHRpb25zLmNkYXRhS2V5XSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdlJlc3VsdFtvcHRpb25zLmNkYXRhS2V5XS5wdXNoKG9Ob2RlLm5vZGVWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2UmVzdWx0W29wdGlvbnMuY2RhdGFLZXldID0gb05vZGUubm9kZVZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9IC8qIG5vZGVUeXBlIGlzIFwiQ0RBVEFTZWN0aW9uXCIgKDQpICovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKG9Ob2RlLm5vZGVUeXBlID09PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzQ29sbGVjdGVkVHh0ICs9IG9Ob2RlLm5vZGVWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSAvKiBub2RlVHlwZSBpcyBcIlRleHRcIiAoMykgKi9cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAob05vZGUubm9kZVR5cGUgPT09IDEpIHsgLyogbm9kZVR5cGUgaXMgXCJFbGVtZW50XCIgKDEpICovXHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5MZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2UmVzdWx0ID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXNpbmcgbm9kZU5hbWUgdG8gc3VwcG9ydCBicm93c2VyIChJRSkgaW1wbGVtZW50YXRpb24gd2l0aCBubyAnbG9jYWxOYW1lJyBwcm9wZXJ0eVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuc3RyaXBFbGVtUHJlZml4KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc1Byb3AgPSBvTm9kZS5ub2RlTmFtZS5yZXBsYWNlKHByZWZpeE1hdGNoLCAnJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNQcm9wID0gb05vZGUubm9kZU5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdkNvbnRlbnQgPSB4bWxUb0pTT04ucGFyc2VYTUwob05vZGUpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2UmVzdWx0Lmhhc093blByb3BlcnR5KHNQcm9wKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2UmVzdWx0W3NQcm9wXS5jb25zdHJ1Y3RvciAhPT0gQXJyYXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdlJlc3VsdFtzUHJvcF0gPSBbdlJlc3VsdFtzUHJvcF1dO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2UmVzdWx0W3NQcm9wXS5wdXNoKHZDb250ZW50KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmNoaWxkcmVuQXNBcnJheSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2UmVzdWx0W3NQcm9wXSA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2UmVzdWx0W3NQcm9wXS5wdXNoKHZDb250ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2UmVzdWx0W3NQcm9wXSA9IHZDb250ZW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuTGVuZ3RoKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFzQ29sbGVjdGVkVHh0KSB7IC8vIG5vIGNoaWxkcmVuIGFuZCBubyB0ZXh0LCByZXR1cm4gbnVsbFxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmNoaWxkcmVuQXNBcnJheSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2UmVzdWx0W29wdGlvbnMudGV4dEtleV0gPSBbXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdlJlc3VsdFtvcHRpb25zLnRleHRLZXldLnB1c2gobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdlJlc3VsdFtvcHRpb25zLnRleHRLZXldID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHNDb2xsZWN0ZWRUeHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5ncm9rVGV4dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSB0aGlzLmdyb2tUeXBlKHNDb2xsZWN0ZWRUeHQucmVwbGFjZSh0cmltTWF0Y2gsICcnKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2UmVzdWx0W29wdGlvbnMudGV4dEtleV0gPSB2YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5ub3JtYWxpemUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdlJlc3VsdFtvcHRpb25zLnRleHRLZXldID0gc0NvbGxlY3RlZFR4dC5yZXBsYWNlKHRyaW1NYXRjaCwgJycpLnJlcGxhY2UoL1xccysvZywgXCIgXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZSZXN1bHRbb3B0aW9ucy50ZXh0S2V5XSA9IHNDb2xsZWN0ZWRUeHQucmVwbGFjZSh0cmltTWF0Y2gsICcnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHZSZXN1bHQ7XHJcbiAgICAgICAgICAgIH1cclxuXHJcblxyXG4gICAgICAgICAgICAvLyBDb252ZXJ0IHhtbERvY3VtZW50IHRvIGEgc3RyaW5nXHJcbiAgICAgICAgICAgIC8vIFJldHVybnMgbnVsbCBvbiBmYWlsdXJlXHJcbiAgICAgICAgICAgIHRoaXMueG1sVG9TdHJpbmcgPSBmdW5jdGlvbiAoeG1sRG9jKSB7XHJcbiAgICAgICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB4bWxTdHJpbmcgPSB4bWxEb2MueG1sID8geG1sRG9jLnhtbCA6IChuZXcgWE1MU2VyaWFsaXplcigpKS5zZXJpYWxpemVUb1N0cmluZyh4bWxEb2MpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB4bWxTdHJpbmc7XHJcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gQ29udmVydCBhIHN0cmluZyB0byBYTUwgTm9kZSBTdHJ1Y3R1cmVcclxuICAgICAgICAgICAgLy8gUmV0dXJucyBudWxsIG9uIGZhaWx1cmVcclxuICAgICAgICAgICAgdGhpcy5zdHJpbmdUb1hNTCA9IGZ1bmN0aW9uICh4bWxTdHJpbmcpIHtcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHhtbERvYyA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh3aW5kb3cuRE9NUGFyc2VyKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcGFyc2VyID0gbmV3IERPTVBhcnNlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB4bWxEb2MgPSBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKHhtbFN0cmluZywgXCJ0ZXh0L3htbFwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB4bWxEb2M7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgeG1sRG9jID0gbmV3IEFjdGl2ZVhPYmplY3QoXCJNaWNyb3NvZnQuWE1MRE9NXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB4bWxEb2MuYXN5bmMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgeG1sRG9jLmxvYWRYTUwoeG1sU3RyaW5nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB4bWxEb2M7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcclxuICAgICAgICB9KS5jYWxsKHt9KTtcclxuICAgICAgICByZXR1cm4geG1sVG9KU09OO1xyXG4gICAgfVxyXG5cclxuXHJcbn1cclxuXHJcblxyXG4vKiB0c2xpbnQ6ZGlzYWJsZSAqL1xyXG4vLyBwb2x5ZmlsbCBmb3IgT2JqZWN0LmFzc2lnbiAobm90IHBhcnQgb2YgVFMgeWV0KVxyXG4vLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9PYmplY3QvYXNzaWduXHJcbmlmICghT2JqZWN0LmFzc2lnbikge1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE9iamVjdCwgXCJhc3NpZ25cIiwge1xyXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcclxuICAgICAgICB3cml0YWJsZTogdHJ1ZSxcclxuICAgICAgICB2YWx1ZTogZnVuY3Rpb24gKHRhcmdldCkge1xyXG4gICAgICAgICAgICBcInVzZSBzdHJpY3RcIjtcclxuICAgICAgICAgICAgaWYgKHRhcmdldCA9PT0gdW5kZWZpbmVkIHx8IHRhcmdldCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjb252ZXJ0IGZpcnN0IGFyZ3VtZW50IHRvIG9iamVjdFwiKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdmFyIHRvID0gT2JqZWN0KHRhcmdldCk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgbmV4dFNvdXJjZSA9IGFyZ3VtZW50c1tpXTtcclxuICAgICAgICAgICAgICAgIGlmIChuZXh0U291cmNlID09PSB1bmRlZmluZWQgfHwgbmV4dFNvdXJjZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbmV4dFNvdXJjZSA9IE9iamVjdChuZXh0U291cmNlKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIga2V5c0FycmF5ID0gT2JqZWN0LmtleXMobmV4dFNvdXJjZSk7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBuZXh0SW5kZXggPSAwLCBsZW4gPSBrZXlzQXJyYXkubGVuZ3RoOyBuZXh0SW5kZXggPCBsZW47IG5leHRJbmRleCsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5leHRLZXkgPSBrZXlzQXJyYXlbbmV4dEluZGV4XTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IobmV4dFNvdXJjZSwgbmV4dEtleSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRlc2MgIT09IHVuZGVmaW5lZCAmJiBkZXNjLmVudW1lcmFibGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG9bbmV4dEtleV0gPSBuZXh0U291cmNlW25leHRLZXldO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdG87XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn0iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
