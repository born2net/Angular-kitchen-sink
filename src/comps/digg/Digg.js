var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require('angular2/core');
var browser_1 = require('angular2/platform/browser');
var Conts_1 = require("../../../src/Conts");
var Observable_1 = require("rxjs/Observable");
var DiggLoader_1 = require("../../../src/comps/digg/DiggLoader");
var CommBroker_1 = require("../../services/CommBroker");
require('rxjs/add/observable/from');
require('rxjs/add/operator/do');
require('rxjs/add/operator/debounceTime');
require('rxjs/add/operator/distinctUntilChanged');
var Digg = (function () {
    function Digg(commBroker, diggLoader, m_commBroker, viewContainer) {
        this.commBroker = commBroker;
        this.m_commBroker = m_commBroker;
        this.dom = new browser_1.BrowserDomAdapter();
        var self = this;
        self.mode = 'list';
        this.diggs = [];
        self.viewContainer = viewContainer;
        self.el = viewContainer.element.nativeElement;
        self.channel = new Observable_1.Observable(function (observer) {
            self.stream = observer;
        }).share();
        self.channel.debounceTime(1000).distinctUntilChanged().subscribe(function (e) {
            self.diggs = [];
            diggLoader.loadDiggs(e, self.diggs);
        });
        this.listenWinResize();
        var propView = this.commBroker.getService(Conts_1.Consts.Services().Properties);
        if (propView)
            propView.setPropView('Digg');
    }
    Digg.prototype.listenWinResize = function () {
        var self = this;
        self.m_commBroker.onEvent(Conts_1.Consts.Events().WIN_SIZED).subscribe(function (e) {
            self.setSize(e.message.height);
        });
    };
    Digg.prototype.ngAfterContentInit = function () {
        this.tileStyle = this.mode == "tiles" ? true : false;
        this.setSize(this.m_commBroker.getValue(Conts_1.Consts.Values().APP_SIZE).height);
    };
    Digg.prototype.setSize = function (height) {
        var h = height - 400;
        var el = this.dom.getElementsByClassName(this.el, 'diggContainer')[0];
        this.dom.setStyle(el, 'height', h);
    };
    Digg.prototype.onSearch = function (event) {
        this.stream.next(event.target.value);
    };
    Digg = __decorate([
        core_1.Component({
            selector: 'Digg',
            inputs: ['mode:mode'],
            encapsulation: core_1.ViewEncapsulation.Emulated,
            providers: [DiggLoader_1.DiggLoader],
            styles: ["\n        .diggContainer {\n            overflow-y: scroll;\n            height: 300px;\n        };\n        .largeImage {\n           max-width: 100px;\n           max-height: 60px;\n        }\n        .smallImage {\n           width: 70px;\n           height: 40px;\n        }\n        .grow { transition: all .2s ease-in-out; }\n        .grow:hover { transform: scale(1.1); opacity: 0.7}\n    "],
            template: "\n        <h1>Digg</h1>\n        <div class=\"appHeight\">\n             <form (submit)=\"$event.preventDefault();\">\n                <br/>\n                <div class=\"input-group\">\n                      <span class=\"input-group-addon\" id=\"symbol-input\">Digg filter</span>\n                      <input type=\"text\" class=\"form-control\" (keyup)=\"onSearch($event)\" placeholder=\"press [ENTER] for unfiltered result\">\n                    </div>\n              </form>\n              <div class=\"diggContainer list\">\n                  <table class=\"table table-striped\">\n                  <tbody>\n                    <tr *ngFor=\"#digg of diggs\" [ngClass]=\"{'col-xs-4': tileStyle, 'col-lg-3': tileStyle}\">\n                      <td>\n                      <img class=\"img-responsive grow\" [ngClass]=\"{'largeImage': tileStyle, 'smallImage': !tileStyle}\" src=\"{{digg.link}}\"/>\n                      <span>{{digg.title}}</span>\n                      </td>\n                    </tr>\n                  </tbody>\n                </table>\n              </div>\n        </div>\n  "
        }), 
        __metadata('design:paramtypes', [CommBroker_1.CommBroker, DiggLoader_1.DiggLoader, CommBroker_1.CommBroker, core_1.ViewContainerRef])
    ], Digg);
    return Digg;
})();
exports.Digg = Digg;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBzL2RpZ2cvZGlnZy50cyJdLCJuYW1lcyI6WyJEaWdnIiwiRGlnZy5jb25zdHJ1Y3RvciIsIkRpZ2cubGlzdGVuV2luUmVzaXplIiwiRGlnZy5uZ0FmdGVyQ29udGVudEluaXQiLCJEaWdnLnNldFNpemUiLCJEaWdnLm9uU2VhcmNoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFZQSxxQkFBNkQsZUFBZSxDQUFDLENBQUE7QUFDN0Usd0JBQWdDLDJCQUEyQixDQUFDLENBQUE7QUFDNUQsc0JBQXFCLG9CQUFvQixDQUFDLENBQUE7QUFDMUMsMkJBQXlCLGlCQUFpQixDQUFDLENBQUE7QUFDM0MsMkJBQXlCLG9DQUFvQyxDQUFDLENBQUE7QUFHOUQsMkJBQW1DLDJCQUEyQixDQUFDLENBQUE7QUFDL0QsUUFBTywwQkFBMEIsQ0FBQyxDQUFBO0FBQ2xDLFFBQU8sc0JBQXNCLENBQUMsQ0FBQTtBQUM5QixRQUFPLGdDQUFnQyxDQUFDLENBQUE7QUFDeEMsUUFBTyx3Q0FBd0MsQ0FBQyxDQUFBO0FBSWhEO0lBeURJQSxjQUFvQkEsVUFBcUJBLEVBQUVBLFVBQXFCQSxFQUFVQSxZQUF1QkEsRUFBRUEsYUFBOEJBO1FBQTdHQyxlQUFVQSxHQUFWQSxVQUFVQSxDQUFXQTtRQUFpQ0EsaUJBQVlBLEdBQVpBLFlBQVlBLENBQVdBO1FBRnpGQSxRQUFHQSxHQUFHQSxJQUFJQSwyQkFBaUJBLEVBQUVBLENBQUNBO1FBR2xDQSxJQUFJQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUNoQkEsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsTUFBTUEsQ0FBQ0E7UUFDbkJBLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLEVBQUVBLENBQUNBO1FBQ2hCQSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxhQUFhQSxDQUFDQTtRQUNuQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsR0FBR0EsYUFBYUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsYUFBYUEsQ0FBQ0E7UUFFOUNBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLElBQUlBLHVCQUFVQSxDQUFDQSxVQUFBQSxRQUFRQTtZQUNsQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsUUFBUUEsQ0FBQ0E7UUFDM0JBLENBQUNBLENBQUNBLENBQUNBLEtBQUtBLEVBQUVBLENBQUNBO1FBR1hBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLFlBQVlBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLG9CQUFvQkEsRUFBRUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsVUFBQ0EsQ0FBQ0E7WUFDL0RBLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLEVBQUVBLENBQUNBO1lBQ2hCQSxVQUFVQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQSxFQUFFQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFBQTtRQUN2Q0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDSEEsSUFBSUEsQ0FBQ0EsZUFBZUEsRUFBRUEsQ0FBQ0E7UUFDdkJBLElBQUlBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLFVBQVVBLENBQUNBLGNBQU1BLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBO1FBQ3hFQSxFQUFFQSxDQUFDQSxDQUFDQSxRQUFRQSxDQUFDQTtZQUNUQSxRQUFRQSxDQUFDQSxXQUFXQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtJQUNyQ0EsQ0FBQ0E7SUFFT0QsOEJBQWVBLEdBQXZCQTtRQUNJRSxJQUFJQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUNoQkEsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsY0FBTUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsVUFBQ0EsQ0FBVUE7WUFDdEVBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBLE9BQU9BLENBQUNBLE1BQU1BLENBQUNBLENBQUFBO1FBQ2xDQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUNQQSxDQUFDQTtJQUVERixpQ0FBa0JBLEdBQWxCQTtRQUNJRyxJQUFJQSxDQUFDQSxTQUFTQSxHQUFHQSxJQUFJQSxDQUFDQSxJQUFJQSxJQUFJQSxPQUFPQSxHQUFHQSxJQUFJQSxHQUFHQSxLQUFLQSxDQUFDQTtRQUNyREEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsY0FBTUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7SUFDOUVBLENBQUNBO0lBRU9ILHNCQUFPQSxHQUFmQSxVQUFnQkEsTUFBTUE7UUFDbEJJLElBQUlBLENBQUNBLEdBQU9BLE1BQU1BLEdBQUdBLEdBQUdBLENBQUNBO1FBRXpCQSxJQUFJQSxFQUFFQSxHQUFHQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxzQkFBc0JBLENBQUNBLElBQUlBLENBQUNBLEVBQUVBLEVBQUVBLGVBQWVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ3RFQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxRQUFRQSxDQUFDQSxFQUFFQSxFQUFFQSxRQUFRQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUN2Q0EsQ0FBQ0E7SUFFT0osdUJBQVFBLEdBQWhCQSxVQUFpQkEsS0FBS0E7UUFDbEJLLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLEtBQUtBLENBQUNBLENBQUNBO0lBQ3pDQSxDQUFDQTtJQXBHTEw7UUFBQ0EsZ0JBQVNBLENBQUNBO1lBQ1BBLFFBQVFBLEVBQUVBLE1BQU1BO1lBQ2hCQSxNQUFNQSxFQUFFQSxDQUFDQSxXQUFXQSxDQUFDQTtZQUNyQkEsYUFBYUEsRUFBRUEsd0JBQWlCQSxDQUFDQSxRQUFRQTtZQUN6Q0EsU0FBU0EsRUFBRUEsQ0FBQ0EsdUJBQVVBLENBQUNBO1lBQ3ZCQSxNQUFNQSxFQUFFQSxDQUFDQSw4WUFlUkEsQ0FBQ0E7WUFDRkEsUUFBUUEsRUFBRUEscWxDQXVCWEE7U0FDRkEsQ0FBQ0E7O2FBd0REQTtJQUFEQSxXQUFDQTtBQUFEQSxDQXJHQSxBQXFHQ0EsSUFBQTtBQXREWSxZQUFJLE9Bc0RoQixDQUFBIiwiZmlsZSI6ImNvbXBzL2RpZ2cvRGlnZy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbiBuZzJCb2lsZXJwbGF0ZSBhcHBsaWNhdGlvblxyXG5cclxuIEdldCB1cCBhbmQgcnVubmluZyBxdWlja2x5IHdpdGggYSB3b3JraW5nXHJcbiBhcHBsaWNhdGlvbiB3aXRoIHNvbGlkIGZvdW5kYXRpb24gZm9yXHJcbiBHb29nbGUncyBBbmd1bGFyIDJcclxuXHJcbiBHaXRIdWI6IGh0dHBzOi8vZ2l0aHViLmNvbS9ib3JuMm5ldC9uZzJCb2lsZXJwbGF0ZVxyXG5cclxuIExpY2VuY2U6IE1JVFxyXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cclxuXHJcbmltcG9ydCB7Q29tcG9uZW50LCBWaWV3Q29udGFpbmVyUmVmLCBWaWV3RW5jYXBzdWxhdGlvbn0gZnJvbSAnYW5ndWxhcjIvY29yZSc7XHJcbmltcG9ydCB7QnJvd3NlckRvbUFkYXB0ZXJ9IGZyb20gJ2FuZ3VsYXIyL3BsYXRmb3JtL2Jyb3dzZXInO1xyXG5pbXBvcnQge0NvbnN0c30gZnJvbSBcIi4uLy4uLy4uL3NyYy9Db250c1wiO1xyXG5pbXBvcnQge09ic2VydmFibGV9IGZyb20gXCJyeGpzL09ic2VydmFibGVcIjtcclxuaW1wb3J0IHtEaWdnTG9hZGVyfSBmcm9tIFwiLi4vLi4vLi4vc3JjL2NvbXBzL2RpZ2cvRGlnZ0xvYWRlclwiO1xyXG5pbXBvcnQge09ic2VydmVyfSBmcm9tIFwicnhqcy9PYnNlcnZlclwiO1xyXG5pbXBvcnQge0lEaWdnfSBmcm9tIFwiLi9EaWdnTG9hZGVyXCI7XHJcbmltcG9ydCB7Q29tbUJyb2tlciwgSU1lc3NhZ2V9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9Db21tQnJva2VyXCI7XHJcbmltcG9ydCAncnhqcy9hZGQvb2JzZXJ2YWJsZS9mcm9tJztcclxuaW1wb3J0ICdyeGpzL2FkZC9vcGVyYXRvci9kbyc7XHJcbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvZGVib3VuY2VUaW1lJztcclxuaW1wb3J0ICdyeGpzL2FkZC9vcGVyYXRvci9kaXN0aW5jdFVudGlsQ2hhbmdlZCc7XHJcblxyXG5cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICdEaWdnJyxcclxuICAgIGlucHV0czogWydtb2RlOm1vZGUnXSxcclxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLkVtdWxhdGVkLCAvLyBzbyB3ZSBkb24ndCBibGVlZCBvdXIgc3R5bGVzIHRvIHJlc3Qgb2YgZG9tXHJcbiAgICBwcm92aWRlcnM6IFtEaWdnTG9hZGVyXSxcclxuICAgIHN0eWxlczogW2BcclxuICAgICAgICAuZGlnZ0NvbnRhaW5lciB7XHJcbiAgICAgICAgICAgIG92ZXJmbG93LXk6IHNjcm9sbDtcclxuICAgICAgICAgICAgaGVpZ2h0OiAzMDBweDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIC5sYXJnZUltYWdlIHtcclxuICAgICAgICAgICBtYXgtd2lkdGg6IDEwMHB4O1xyXG4gICAgICAgICAgIG1heC1oZWlnaHQ6IDYwcHg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC5zbWFsbEltYWdlIHtcclxuICAgICAgICAgICB3aWR0aDogNzBweDtcclxuICAgICAgICAgICBoZWlnaHQ6IDQwcHg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC5ncm93IHsgdHJhbnNpdGlvbjogYWxsIC4ycyBlYXNlLWluLW91dDsgfVxyXG4gICAgICAgIC5ncm93OmhvdmVyIHsgdHJhbnNmb3JtOiBzY2FsZSgxLjEpOyBvcGFjaXR5OiAwLjd9XHJcbiAgICBgXSxcclxuICAgIHRlbXBsYXRlOiBgXHJcbiAgICAgICAgPGgxPkRpZ2c8L2gxPlxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJhcHBIZWlnaHRcIj5cclxuICAgICAgICAgICAgIDxmb3JtIChzdWJtaXQpPVwiJGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XCI+XHJcbiAgICAgICAgICAgICAgICA8YnIvPlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImlucHV0LWdyb3VwXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cImlucHV0LWdyb3VwLWFkZG9uXCIgaWQ9XCJzeW1ib2wtaW5wdXRcIj5EaWdnIGZpbHRlcjwvc3Bhbj5cclxuICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwidGV4dFwiIGNsYXNzPVwiZm9ybS1jb250cm9sXCIgKGtleXVwKT1cIm9uU2VhcmNoKCRldmVudClcIiBwbGFjZWhvbGRlcj1cInByZXNzIFtFTlRFUl0gZm9yIHVuZmlsdGVyZWQgcmVzdWx0XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgPC9mb3JtPlxyXG4gICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJkaWdnQ29udGFpbmVyIGxpc3RcIj5cclxuICAgICAgICAgICAgICAgICAgPHRhYmxlIGNsYXNzPVwidGFibGUgdGFibGUtc3RyaXBlZFwiPlxyXG4gICAgICAgICAgICAgICAgICA8dGJvZHk+XHJcbiAgICAgICAgICAgICAgICAgICAgPHRyICpuZ0Zvcj1cIiNkaWdnIG9mIGRpZ2dzXCIgW25nQ2xhc3NdPVwieydjb2wteHMtNCc6IHRpbGVTdHlsZSwgJ2NvbC1sZy0zJzogdGlsZVN0eWxlfVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgPHRkPlxyXG4gICAgICAgICAgICAgICAgICAgICAgPGltZyBjbGFzcz1cImltZy1yZXNwb25zaXZlIGdyb3dcIiBbbmdDbGFzc109XCJ7J2xhcmdlSW1hZ2UnOiB0aWxlU3R5bGUsICdzbWFsbEltYWdlJzogIXRpbGVTdHlsZX1cIiBzcmM9XCJ7e2RpZ2cubGlua319XCIvPlxyXG4gICAgICAgICAgICAgICAgICAgICAgPHNwYW4+e3tkaWdnLnRpdGxlfX08L3NwYW4+XHJcbiAgICAgICAgICAgICAgICAgICAgICA8L3RkPlxyXG4gICAgICAgICAgICAgICAgICAgIDwvdHI+XHJcbiAgICAgICAgICAgICAgICAgIDwvdGJvZHk+XHJcbiAgICAgICAgICAgICAgICA8L3RhYmxlPlxyXG4gICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgIDwvZGl2PlxyXG4gIGBcclxufSlcclxuXHJcbmV4cG9ydCBjbGFzcyBEaWdnIHtcclxuICAgIHByaXZhdGUgbW9kZTpzdHJpbmc7XHJcbiAgICBwcml2YXRlIHRpbGVTdHlsZTpib29sZWFuO1xyXG4gICAgcHJpdmF0ZSBjaGFubmVsOk9ic2VydmFibGU8YW55W10+O1xyXG4gICAgcHJpdmF0ZSBzdHJlYW06T2JzZXJ2ZXI8YW55W10+O1xyXG4gICAgcHJpdmF0ZSBkaWdnczpJRGlnZ1tdO1xyXG4gICAgcHJpdmF0ZSBlbDphbnk7XHJcbiAgICBwcml2YXRlIHZpZXdDb250YWluZXI6Vmlld0NvbnRhaW5lclJlZjtcclxuICAgIHByaXZhdGUgZG9tID0gbmV3IEJyb3dzZXJEb21BZGFwdGVyKCk7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBjb21tQnJva2VyOkNvbW1Ccm9rZXIsIGRpZ2dMb2FkZXI6RGlnZ0xvYWRlciwgcHJpdmF0ZSBtX2NvbW1Ccm9rZXI6Q29tbUJyb2tlciwgdmlld0NvbnRhaW5lcjpWaWV3Q29udGFpbmVyUmVmKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHNlbGYubW9kZSA9ICdsaXN0JztcclxuICAgICAgICB0aGlzLmRpZ2dzID0gW107XHJcbiAgICAgICAgc2VsZi52aWV3Q29udGFpbmVyID0gdmlld0NvbnRhaW5lcjtcclxuICAgICAgICBzZWxmLmVsID0gdmlld0NvbnRhaW5lci5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQ7XHJcblxyXG4gICAgICAgIHNlbGYuY2hhbm5lbCA9IG5ldyBPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcclxuICAgICAgICAgICAgc2VsZi5zdHJlYW0gPSBvYnNlcnZlcjtcclxuICAgICAgICB9KS5zaGFyZSgpO1xyXG5cclxuICAgICAgICAvLyBmb3IgYSBjbGVhbmVyIGFwcHJvYWNoIHRvIE9ic2VydmFibGUgZW5kcG9pbnQgc2VydmVyIGNhbGxzIHNlZSBXZWF0aGVyIGNvbXBvbmVudFxyXG4gICAgICAgIHNlbGYuY2hhbm5lbC5kZWJvdW5jZVRpbWUoMTAwMCkuZGlzdGluY3RVbnRpbENoYW5nZWQoKS5zdWJzY3JpYmUoKGUpPT4ge1xyXG4gICAgICAgICAgICBzZWxmLmRpZ2dzID0gW107XHJcbiAgICAgICAgICAgIGRpZ2dMb2FkZXIubG9hZERpZ2dzKGUsIHNlbGYuZGlnZ3MpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5saXN0ZW5XaW5SZXNpemUoKTtcclxuICAgICAgICB2YXIgcHJvcFZpZXcgPSB0aGlzLmNvbW1Ccm9rZXIuZ2V0U2VydmljZShDb25zdHMuU2VydmljZXMoKS5Qcm9wZXJ0aWVzKTtcclxuICAgICAgICBpZiAocHJvcFZpZXcpXHJcbiAgICAgICAgICAgIHByb3BWaWV3LnNldFByb3BWaWV3KCdEaWdnJyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBsaXN0ZW5XaW5SZXNpemUoKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHNlbGYubV9jb21tQnJva2VyLm9uRXZlbnQoQ29uc3RzLkV2ZW50cygpLldJTl9TSVpFRCkuc3Vic2NyaWJlKChlOklNZXNzYWdlKT0+IHtcclxuICAgICAgICAgICAgc2VsZi5zZXRTaXplKGUubWVzc2FnZS5oZWlnaHQpXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xyXG4gICAgICAgIHRoaXMudGlsZVN0eWxlID0gdGhpcy5tb2RlID09IFwidGlsZXNcIiA/IHRydWUgOiBmYWxzZTtcclxuICAgICAgICB0aGlzLnNldFNpemUodGhpcy5tX2NvbW1Ccm9rZXIuZ2V0VmFsdWUoQ29uc3RzLlZhbHVlcygpLkFQUF9TSVpFKS5oZWlnaHQpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0U2l6ZShoZWlnaHQpIHtcclxuICAgICAgICB2YXIgaDphbnkgPSBoZWlnaHQgLSA0MDA7XHJcbiAgICAgICAgLy92YXIgZWwgPSB0aGlzLmRvbS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKHRoaXMuZWwsIHRoaXMubW9kZSlbMF07XHJcbiAgICAgICAgdmFyIGVsID0gdGhpcy5kb20uZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSh0aGlzLmVsLCAnZGlnZ0NvbnRhaW5lcicpWzBdO1xyXG4gICAgICAgIHRoaXMuZG9tLnNldFN0eWxlKGVsLCAnaGVpZ2h0JywgaCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBvblNlYXJjaChldmVudCkge1xyXG4gICAgICAgIHRoaXMuc3RyZWFtLm5leHQoZXZlbnQudGFyZ2V0LnZhbHVlKTtcclxuICAgIH1cclxufSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
