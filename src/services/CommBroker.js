var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
var core_1 = require('angular2/core');
require('rxjs/add/operator/debounceTime');
require('rxjs/add/operator/do');
require('rxjs/add/operator/filter');
require('rxjs/add/operator/share');
var Subject_1 = require("rxjs/Subject");
var CommBroker = (function () {
    function CommBroker() {
        this.randomName = Math.random();
        var self = this;
        self.services = [];
        self.streamMessages = new Subject_1.Subject();
        self.streamMessages.share();
        document['commBroker'] = this;
    }
    CommBroker.prototype.toString = function () {
        return 'CommBroker ' + this.randomName;
    };
    CommBroker.prototype.fire = function (iMessage) {
        var self = this;
        self.streamMessages.next(iMessage);
    };
    CommBroker.prototype.onEvent = function (event) {
        var self = this;
        return self.streamMessages.filter(function (e) {
            return e.event == event;
        });
    };
    CommBroker.prototype.onInstance = function (instance) {
        var self = this;
        return self.streamMessages.filter(function (e) {
            return e.fromInstance == instance;
        });
    };
    CommBroker.prototype.onInstanceAndEvent = function (instance, event) {
        var self = this;
        return self.streamMessages.filter(function (e) {
            return e.fromInstance == instance && e.event == event;
        });
    };
    CommBroker.prototype.setService = function (i_name, i_service) {
        this.services[i_name] = i_service;
    };
    CommBroker.prototype.getService = function (i_name) {
        if (i_name == undefined) {
            return undefined;
        }
        if (this.services[i_name]) {
            return this.services[i_name];
        }
        else {
            return undefined;
        }
    };
    CommBroker.prototype.getAllServices = function () {
        return this.services;
    };
    CommBroker.prototype.clearServices = function () {
        var self = this;
        self.services = undefined;
    };
    CommBroker.prototype.setValue = function (i_name, i_value, i_fireEvent) {
        var self = this;
        this.services[i_name] = i_value;
        if (i_fireEvent) {
            var msg = {
                fromInstance: self,
                event: i_fireEvent,
                context: null,
                message: { name: i_name, value: i_value }
            };
            self.fire(msg);
        }
    };
    CommBroker.prototype.getValue = function (i_name) {
        if (this.services[i_name]) {
            return this.services[i_name];
        }
        else {
            return undefined;
        }
    };
    CommBroker = __decorate([
        core_1.Injectable(), 
        __metadata('design:paramtypes', [])
    ], CommBroker);
    return CommBroker;
})();
exports.CommBroker = CommBroker;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcnZpY2VzL2NvbW1icm9rZXIudHMiXSwibmFtZXMiOlsiQ29tbUJyb2tlciIsIkNvbW1Ccm9rZXIuY29uc3RydWN0b3IiLCJDb21tQnJva2VyLnRvU3RyaW5nIiwiQ29tbUJyb2tlci5maXJlIiwiQ29tbUJyb2tlci5vbkV2ZW50IiwiQ29tbUJyb2tlci5vbkluc3RhbmNlIiwiQ29tbUJyb2tlci5vbkluc3RhbmNlQW5kRXZlbnQiLCJDb21tQnJva2VyLnNldFNlcnZpY2UiLCJDb21tQnJva2VyLmdldFNlcnZpY2UiLCJDb21tQnJva2VyLmdldEFsbFNlcnZpY2VzIiwiQ29tbUJyb2tlci5jbGVhclNlcnZpY2VzIiwiQ29tbUJyb2tlci5zZXRWYWx1ZSIsIkNvbW1Ccm9rZXIuZ2V0VmFsdWUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLHFCQUFvQyxlQUFlLENBQUMsQ0FBQTtBQUVwRCxRQUFPLGdDQUFnQyxDQUFDLENBQUE7QUFDeEMsUUFBTyxzQkFBc0IsQ0FBQyxDQUFBO0FBQzlCLFFBQU8sMEJBQTBCLENBQUMsQ0FBQTtBQUNsQyxRQUFPLHlCQUF5QixDQUFDLENBQUE7QUFDakMsd0JBQXNCLGNBQWMsQ0FBQyxDQUFBO0FBd0VyQztJQU1JQTtRQUZRQyxlQUFVQSxHQUFVQSxJQUFJQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQTtRQUd0Q0EsSUFBSUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDaEJBLElBQUlBLENBQUNBLFFBQVFBLEdBQUdBLEVBQUVBLENBQUNBO1FBQ25CQSxJQUFJQSxDQUFDQSxjQUFjQSxHQUFHQSxJQUFJQSxpQkFBT0EsRUFBb0JBLENBQUNBO1FBS3REQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQTtRQVU1QkEsUUFBUUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0E7SUFDbENBLENBQUNBO0lBRU1ELDZCQUFRQSxHQUFmQTtRQUNJRSxNQUFNQSxDQUFDQSxhQUFh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QUFJQSxHQUFHQSxHQUFZQTtnQkFDZkEsWUFBWUEsRUFBRUEsSUFBSUE7Z0JBQ2xCQSxLQUFLQSxFQUFFQSxXQUFXQTtnQkFDbEJBLE9BQU9BLEVBQUVBLElBQUlBO2dCQUNiQSxPQUFPQSxFQUFFQSxFQUFDQSxJQUFJQSxFQUFFQSxNQUFNQSxFQUFFQSxLQUFLQSxFQUFFQSxPQUFPQSxFQUFDQTthQUMxQ0EsQ0FBQ0E7WUFDRkEsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDbkJBLENBQUNBO0lBQ0xBLENBQUNBO0lBUURYLDZCQUFRQSxHQUFSQSxVQUFTQSxNQUFNQTtRQUNYWSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUN4QkEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQUE7UUFDaENBLENBQUNBO1FBQUNBLElBQUlBLENBQUNBLENBQUNBO1lBQ0pBLE1BQU1BLENBQUNBLFNBQVNBLENBQUNBO1FBQ3JCQSxDQUFDQTtJQUNMQSxDQUFDQTtJQWhKTFo7UUFBQ0EsaUJBQVVBLEVBQUVBOzttQkFpSlpBO0lBQURBLGlCQUFDQTtBQUFEQSxDQWpKQSxBQWlKQ0EsSUFBQTtBQWhKWSxrQkFBVSxhQWdKdEIsQ0FBQSIsImZpbGUiOiJzZXJ2aWNlcy9Db21tQnJva2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtDb21wb25lbnQsIEluamVjdGFibGV9IGZyb20gJ2FuZ3VsYXIyL2NvcmUnO1xyXG5pbXBvcnQge09ic2VydmVyfSBmcm9tIFwicnhqcy9PYnNlcnZlclwiO1xyXG5pbXBvcnQgJ3J4anMvYWRkL29wZXJhdG9yL2RlYm91bmNlVGltZSc7XHJcbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3IvZG8nO1xyXG5pbXBvcnQgJ3J4anMvYWRkL29wZXJhdG9yL2ZpbHRlcic7XHJcbmltcG9ydCAncnhqcy9hZGQvb3BlcmF0b3Ivc2hhcmUnO1xyXG5pbXBvcnQge1N1YmplY3R9IGZyb20gXCJyeGpzL1N1YmplY3RcIjtcclxuXHJcbi8qKlxyXG5cclxuIENvbW1Ccm9rZXIgaXMgYSBSZWFjdCB0eXBlIE1lZGlhdG9yIGluamVjdGFibGUgc2VydmljZSBwcm92aWRlclxyXG5cclxuIEV4YW1wbGVzXHJcbiA9PT09PT09PT09PT1cclxuIHNlbGYub25FdmVudCgnY2xpY2snKS5zdWJzY3JpYmUoKGU6SU1lc3NhZ2UpPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdJIGhlYXJkIGEgY2xpY2snKTtcclxuICAgIH0pO1xyXG5cclxuIC8vIHdvbid0IHdvcmssIGV2ZW50ICE9IGp1bXBcclxuIHNlbGYub25FdmVudCgnanVtcCcpLnN1YnNjcmliZSgoZTpJTWVzc2FnZSk9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ0kgaGVhcmQgYSBjbGljaycpO1xyXG4gICAgfSk7XHJcblxyXG4gLy8gd29udCB3b3JrLCB0aGlzICE9IHNlbGZcclxuIHNlbGYub25JbnN0YW5jZShudWxsKS5zdWJzY3JpYmUoKGU6SU1lc3NhZ2UpPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdYWVojJCVeJiBzaG91bGQgbmV2ZXIgY29tZSBoZXJlLi4uJyk7XHJcbiAgICB9KTtcclxuXHJcbiBzZWxmLm9uSW5zdGFuY2VBbmRFdmVudCh0aGlzLCAnY2xpY2snKS5zdWJzY3JpYmUoKGU6SU1lc3NhZ2UpPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBJIGhlYXJkIHlvdSBjb21tQnJva2VyIG9uIGV2ZW50IGNsaWNrIGAgKyBlLm1lc3NhZ2UpO1xyXG4gICAgfSk7XHJcblxyXG4gc2VsZi5vbkluc3RhbmNlQW5kRXZlbnQoc2VsZiwgJ2NsaWNrJykuZmlyc3QoKS5zdWJzY3JpYmUoKGU6SU1lc3NhZ2UpPT4ge1xyXG4gICAgICAgIHZhciBjb21tQnJva2VyOkNvbW1Ccm9rZXIgPSBlLmZyb21JbnN0YW5jZTtcclxuICAgICAgICBjb25zb2xlLmxvZyhganVzdCBvbmUgJHtlLmV2ZW50fSBmcm9tICR7Y29tbUJyb2tlci50b1N0cmluZygpfWApO1xyXG4gICAgfSk7XHJcblxyXG4gc2VsZi5vbkluc3RhbmNlQW5kRXZlbnQoc2VsZiwgJ2NsaWNrJykuc3Vic2NyaWJlKChlOklNZXNzYWdlKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYGhhbmRsZSBzdWNjZXNzOiByeCAke2UuZXZlbnR9YClcclxuICAgIH0sIChlKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coYGhhbmRsZSBlcnJvciAke2V9YClcclxuICAgIH0sICgpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgaGFuZGxlIGNvbXBsZXRlYClcclxuICAgIH0pO1xyXG5cclxuIC8vIGJlZm9yZSBzdHJlYW0gcmVhZHlcclxuIHZhciBtc2cxOklNZXNzYWdlID0ge1xyXG4gICAgICAgIGZyb21JbnN0YW5jZTogc2VsZixcclxuICAgICAgICBldmVudDogJ2NsaWNrJyxcclxuICAgICAgICBjb250ZXh0OiAxLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdiZWZvcmUgc3RyZWFtIGlzIHJlYWR5J1xyXG4gICAgfTtcclxuIHNlbGYuZmlyZShtc2cxKTtcclxuXHJcbiAvLyBhZnRlciBzdHJlYW0gcmVhZHlcclxuIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBtc2cyOklNZXNzYWdlID0ge1xyXG4gICAgICAgICAgICBmcm9tSW5zdGFuY2U6IHNlbGYsXHJcbiAgICAgICAgICAgIGV2ZW50OiAnY2xpY2snLFxyXG4gICAgICAgICAgICBjb250ZXh0OiAyLFxyXG4gICAgICAgICAgICBtZXNzYWdlOiAnYWZ0ZXIgc3RyZWFtIGlzIHJlYWR5J1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgc2VsZi5maXJlKG1zZzIpO1xyXG4gICAgfSwgMjAwMClcclxuICoqL1xyXG5cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSU1lc3NhZ2Uge1xyXG4gICAgZnJvbUluc3RhbmNlOiBhbnksXHJcbiAgICBldmVudDogc3RyaW5nLFxyXG4gICAgY29udGV4dDogYW55LFxyXG4gICAgbWVzc2FnZTogYW55XHJcbn1cclxuXHJcbi8vIGNyZWF0ZSBhbiBhbGlhcyB0eXBlIGp1c3Qgc28gaXQncyBlYXNpZXIgdG8gYXNzb2NpYXRlXHJcbnR5cGUgU3ViamVjdE1lc3NhZ2UgPSBTdWJqZWN0PElNZXNzYWdlPjtcclxudHlwZSBTdWJqZWN0TWVzc2FnZXMgPSBTdWJqZWN0PEFycmF5PFN1YmplY3RNZXNzYWdlPj47XHJcblxyXG5ASW5qZWN0YWJsZSgpXHJcbmV4cG9ydCBjbGFzcyBDb21tQnJva2VyIHtcclxuICAgIHByaXZhdGUgc3RyZWFtTWVzc2FnZXM6U3ViamVjdDxJTWVzc2FnZT47XHJcbiAgICBwcml2YXRlIHNlcnZpY2VzOnN0cmluZ1tdO1xyXG4gICAgcHJpdmF0ZSByYW5kb21OYW1lOm51bWJlciA9IE1hdGgucmFuZG9tKCk7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgICAgIHNlbGYuc2VydmljZXMgPSBbXTtcclxuICAgICAgICBzZWxmLnN0cmVhbU1lc3NhZ2VzID0gbmV3IFN1YmplY3QoKSBhcyBTdWJqZWN0TWVzc2FnZTtcclxuXHJcbiAgICAgICAgLy8gd2UgdXNlIHNoYXJlIGFzIGEgc2hvcnRoYW5kIGZvciBwdWJsaXNoKCkgd2hpY2ggY29udmVydHMgY29sZCB0byBob3RcclxuICAgICAgICAvLyBvYnNlcnZhYmxlIGFzIHdlbGwgYXMgY29ubmVjdCgpIC8gcmVmQ291bnQoKVxyXG4gICAgICAgIC8vIHdoZW4gY29ubmVjdGVkIHJlZmVyZW5jZXMgbW92ZXMgZnJvbSAwIHRvIDFcclxuICAgICAgICBzZWxmLnN0cmVhbU1lc3NhZ2VzLnNoYXJlKCk7XHJcblxyXG4gICAgICAgIC8vIGlmIHdlIHdpc2ggdG8gdXNlIGEgdW5pZGlyZWN0aW9uYWwgc3RyZWFtIHdlIGNhbiBjb252ZXJ0IHRvIE9ic2VydmFibGUgaW5zdGVhZCBvZiBzdWJqZWN0XHJcbiAgICAgICAgLy9zZWxmLnN0cmVhbSA9IG5ldyBPYnNlcnZhYmxlKHRyaWdnZXIgPT4ge1xyXG4gICAgICAgIC8vICAgIHRyaWdnZXIubmV4dChtc2cpO1xyXG4gICAgICAgIC8vICAgIHRyaWdnZXIuZXJyb3IoJ2Jvb20nKTtcclxuICAgICAgICAvLyAgICB0cmlnZ2VyLmNvbXBsZXRlKCdkb25lJyk7XHJcbiAgICAgICAgLy99KS5zaGFyZSgpO1xyXG5cclxuICAgICAgICAvLyB0aGlzIGlzIHRoZSBvbmx5IGdsb2JhbCBtZW1iZXIgd2UgZXhwb3NlXHJcbiAgICAgICAgZG9jdW1lbnRbJ2NvbW1Ccm9rZXInXSA9IHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHRvU3RyaW5nKCkge1xyXG4gICAgICAgIHJldHVybiAnQ29tbUJyb2tlciAnICsgdGhpcy5yYW5kb21OYW1lOyAvLyB0byB0ZXN0IHVuaXF1ZW5lc3NcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICBXaXRoIGZpcmUgd2UgcHVzaCBhIHN0cmVhbSBvZiBJTWVzc2FnZXMgaW50byBvdXIgc3RyZWFtLlxyXG4gICAgIEBtZXRob2QgZmlyZVxyXG4gICAgIEBwYXJhbXMgSU1lc3NhZ2VcclxuICAgICAqKi9cclxuICAgIHB1YmxpYyBmaXJlKGlNZXNzYWdlOklNZXNzYWdlKTp2b2lkIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgc2VsZi5zdHJlYW1NZXNzYWdlcy5uZXh0KGlNZXNzYWdlKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgb25FdmVudChldmVudDpzdHJpbmcpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIHNlbGYuc3RyZWFtTWVzc2FnZXMuZmlsdGVyKChlKT0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGUuZXZlbnQgPT0gZXZlbnQ7XHJcbiAgICAgICAgfSlcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgb25JbnN0YW5jZShpbnN0YW5jZTphbnkpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIHNlbGYuc3RyZWFtTWVzc2FnZXMuZmlsdGVyKChlKT0+IHtcclxuICAgICAgICAgICAgcmV0dXJuIGUuZnJvbUluc3RhbmNlID09IGluc3RhbmNlO1xyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG9uSW5zdGFuY2VBbmRFdmVudChpbnN0YW5jZTphbnksIGV2ZW50OnN0cmluZykge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICByZXR1cm4gc2VsZi5zdHJlYW1NZXNzYWdlcy5maWx0ZXIoKGUpPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gZS5mcm9tSW5zdGFuY2UgPT0gaW5zdGFuY2UgJiYgZS5ldmVudCA9PSBldmVudFxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgUmVnaXN0ZXIgYSBzZXJ2aWNlICB0aGF0IG90aGVycyBjYW4gcXVlcnkuXHJcbiAgICAgQG1ldGhvZCBzZXRTZXJ2aWNlXHJcbiAgICAgQHBhcmFtIHtTdHJpbmd9IGlfbmFtZVxyXG4gICAgIEBwYXJhbSB7T2JqZWN0fSBpX3NlcnZpY2VcclxuICAgICBAcmV0dXJuIG5vbmVcclxuICAgICAqKi9cclxuICAgIHNldFNlcnZpY2UoaV9uYW1lLCBpX3NlcnZpY2UpIHtcclxuICAgICAgICB0aGlzLnNlcnZpY2VzW2lfbmFtZV0gPSBpX3NlcnZpY2U7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgR2V0IGEgcmVnaXN0ZXJlZCBzZXJ2aWNlLlxyXG4gICAgIEBtZXRob2QgZ2V0U2VydmljZVxyXG4gICAgIEBwYXJhbSB7U3RyaW5nfSBpX25hbWVcclxuICAgICBAcmV0dXJuIHtPYmplY3R9IHNlcnZpY2VzIG1lbWJlclxyXG4gICAgICoqL1xyXG4gICAgZ2V0U2VydmljZShpX25hbWUpOmFueSB7XHJcbiAgICAgICAgaWYgKGlfbmFtZSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgLy9sb2coJ2NhbnQgZ2V0IHNldCB1bmRlZmluZWQgc2VydmljZSAnICsgaV9uYW1lKTtcclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuc2VydmljZXNbaV9uYW1lXSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZXJ2aWNlc1tpX25hbWVdXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgRXhwb3NlIGFsbCBzZXJ2aWNlcyBhbmQgZGF0YSBtZW1iZXJzLlxyXG4gICAgIEBtZXRob2QgZ2V0QWxsU2VydmljZXNcclxuICAgICBAcmV0dXJuIHtPYmplY3R9IHNlcnZpY2VzXHJcbiAgICAgKiovXHJcbiAgICBnZXRBbGxTZXJ2aWNlcygpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5zZXJ2aWNlcztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICBDbGVhciBhbGwgY3VycmVudCByZWdpc3RlcmVkIHNlcnZpY2VzXHJcbiAgICAgQG1ldGhvZCBjbGVhclNlcnZpY2VzXHJcbiAgICAgKiovXHJcbiAgICBjbGVhclNlcnZpY2VzKCkge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICAvLyBkZWxldGUgc2VsZi5zZXJ2aWNlcztcclxuICAgICAgICBzZWxmLnNlcnZpY2VzID0gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgIFJlZ2lzdGVyIGEgZGF0YSBtZW1iZXIgdGhhdCBvdGhlcnMgY2FuIHF1ZXJ5LlxyXG4gICAgIEBtZXRob2Qgc2V0VmFsdWVcclxuICAgICBAcGFyYW0ge1N0cmluZ30gaV9uYW1lXHJcbiAgICAgQHBhcmFtIHtPYmplY3R9IGlfdmFsdWVcclxuICAgICBAcGFyYW0ge0V2ZW50fSBpX2ZpcmVFdmVudFxyXG4gICAgIEByZXR1cm4gbm9uZVxyXG4gICAgICoqL1xyXG4gICAgc2V0VmFsdWUoaV9uYW1lOmFueSwgaV92YWx1ZTphbnksIGlfZmlyZUV2ZW50PzpzdHJpbmcpOnZvaWQge1xyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICB0aGlzLnNlcnZpY2VzW2lfbmFtZV0gPSBpX3ZhbHVlO1xyXG4gICAgICAgIGlmIChpX2ZpcmVFdmVudCkge1xyXG4gICAgICAgICAgICB2YXIgbXNnOklNZXNzYWdlID0ge1xyXG4gICAgICAgICAgICAgICAgZnJvbUluc3RhbmNlOiBzZWxmLFxyXG4gICAgICAgICAgICAgICAgZXZlbnQ6IGlfZmlyZUV2ZW50LFxyXG4gICAgICAgICAgICAgICAgY29udGV4dDogbnVsbCxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IHtuYW1lOiBpX25hbWUsIHZhbHVlOiBpX3ZhbHVlfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBzZWxmLmZpcmUobXNnKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgR2V0IGEgcmVnaXN0ZXJlZCBkYXRhIG1lbWJlci5cclxuICAgICBAbWV0aG9kIGdldFZhbHVlXHJcbiAgICAgQHBhcmFtIHtTdHJpbmd9IGlfbmFtZVxyXG4gICAgIEByZXR1cm4ge09iamVjdH0gbV9zZXJ2aWNlcyBtZW1iZXJcclxuICAgICAqKi9cclxuICAgIGdldFZhbHVlKGlfbmFtZSk6YW55IHtcclxuICAgICAgICBpZiAodGhpcy5zZXJ2aWNlc1tpX25hbWVdKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNlcnZpY2VzW2lfbmFtZV1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
